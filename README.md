### Финальная пошаговая инструкция: Автозапуск приложения в TTY на Raspberry Pi OS

**Цель:** Настроить Raspberry Pi так, чтобы при включении она автоматически загружалась в полноэкранное консольное приложение с полной поддержкой русского языка, без необходимости каких-либо действий со стороны пользователя.

Эта инструкция учитывает особенности последних версий Raspberry Pi OS, включая проблемы с инициализацией кириллицы в консоли `tty1`.

---

### Часть 1: Базовая настройка системы и языка

#### Шаг 1.1: Настройка отображения кириллицы в консоли
Мы сделаем это "ручным" методом, так как он более надежен, чем стандартный `raspi-config` для консольного режима.

1.  Запустите утилиту настройки консоли:
    ```bash
    sudo dpkg-reconfigure console-setup
    ```
2.  В появившемся текстовом меню последовательно выберите:
    *   **Кодировка:** `UTF-8`
    *   **Набор символов:** `. комбинированный - латинский; славянская кириллица; ...`
    *   **Шрифт:** `Terminus` (рекомендуется) или `Fixed`.
    *   **Размер шрифта:** Выберите подходящий вам размер, например, `8x16` для стандартного или `16x32` для очень крупного.

#### Шаг 1.2: Настройка ввода кириллицы (раскладка клавиатуры)
1.  Запустите утилиту настройки клавиатуры:
    ```bash
    sudo dpkg-reconfigure keyboard-configuration
    ```
2.  В меню выберите:
    *   **Модель клавиатуры:** `Generic 105-key PC` (или ваша).
    *   **Раскладка:** `Russian`.
    *   **Способ переключения раскладок:** `Alt+Shift` (или удобный вам).
    *   Остальные параметры оставьте по умолчанию.

---

### Часть 2: Настройка автоматического запуска приложения

Мы будем использовать связку "автоматический вход пользователя + скрипт в профиле". Это самый стабильный метод.

#### Шаг 2.1: Настройка автологина пользователя на TTY2
Мы будем использовать `tty2`, так как `tty1` часто бывает занят системными сообщениями и имеет проблемы с инициализацией.

1.  Создайте директорию для переопределения настроек системной службы:
    ```bash
    sudo mkdir -p /etc/systemd/system/getty@tty2.service.d/
    ```
2.  Создайте и откройте файл конфигурации в этой директории:
    ```bash
    sudo nano /etc/systemd/system/getty@tty2.service.d/override.conf
    ```
3.  Вставьте в этот файл следующий текст, **заменив `bearshark` на имя вашего пользователя**:
    ```ini
    [Service]
    ExecStart=
    ExecStart=-/sbin/agetty --autologin bearshark --noclear %I $TERM
    ```
4.  Сохраните файл (`Ctrl+O`, `Enter`) и выйдите (`Ctrl+X`).

#### Шаг 2.2: Создание скрипта автозапуска приложения
Этот скрипт будет выполняться сразу после того, как ваш пользователь автоматически войдет в систему на `tty2`.

1.  Откройте файл `.bash_profile` в вашей домашней директории (**без `sudo`**):
    ```bash
    nano ~/.bash_profile
    ```
2.  Вставьте в него следующий код, **заменив пути и имя исполняемого файла на свои**:
    ```bash
    # Этот скрипт будет выполняться только при входе в терминал TTY2
    if [ "$(tty)" = "/dev/tty2" ]; then
      
      # ВАЖНЫЙ ШАГ: Принудительно применяем настройки шрифтов и кодировки.
      # Это решает проблему "гонки состояний", когда приложение запускается
      # раньше, чем система успевает настроить кириллицу.
      /usr/bin/setupcon

      # Переходим в рабочую директорию и запускаем приложение.
      # Замените путь и имя файла на свои.
      cd /home/bearshark/Downloads/modules/publish/ && /home/bearshark/Downloads/modules/publish/Mudules
    
    fi
    ```
3.  Сохраните и выйдите.
4.  Дайте вашему приложению права на исполнение (замените путь на свой):
    ```bash
    chmod +x /home/bearshark/Downloads/modules/publish/Mudules
    ```

---

### Часть 3: Настройка загрузки и отображения

Теперь мы настроим систему так, чтобы она загружалась в консоль и автоматически показывала нам `tty2`.

#### Шаг 3.1: Переключение на консольный режим загрузки
1.  Запустите утилиту `raspi-config`:
    ```bash
    sudo raspi-config
    ```
2.  В меню выберите `1 System Options` -> `S5 Boot / Auto Login` -> **`B1 Console`**.
3.  Нажмите `<Finish>` и на вопрос о перезагрузке пока ответьте **`<No>`**.

#### Шаг 3.2: Создание службы для автоматического переключения на TTY2
Этот метод надежнее, чем параметр ядра `vt.default_TTY`, который у нас не сработал.

1.  Создайте файл новой системной службы:
    ```bash
    sudo nano /etc/systemd/system/switch-to-tty2.service
    ```
2.  Вставьте в этот файл следующий текст:
    ```ini
    [Unit]
    Description=Switch to TTY2 at the end of boot
    After=getty.target

    [Service]
    Type=oneshot
    ExecStart=/usr/bin/chvt 2
    StandardInput=tty
    StandardOutput=tty
    TTYPath=/dev/tty1

    [Install]
    WantedBy=multi-user.target
    ```
3.  Сохраните и выйдите.

#### Шаг 3.3: Включение новой службы
1.  Включите службу, чтобы она стартовала при каждой загрузке:
    ```bash
    sudo systemctl enable switch-to-tty2.service
    ```

---

### Часть 4: Финальная перезагрузка

Теперь, когда все настроено, перезагрузите Raspberry Pi:
```bash
sudo reboot
```

**Ожидаемый результат:** После перезагрузки система на несколько секунд покажет текстовые сообщения на `tty1`, а затем автоматически переключится на `tty2`, где вы сразу увидите ваше работающее приложение с корректной поддержкой русского языка и выбранным вами размером шрифта. Задача выполнена


### Часть 5: Установка своей картинки запуска

Темы Plymouth находятся в директории:
```
/usr/share/plymouth/themes/
```

В Raspberry Pi OS по умолчанию используется тема pix. Соответственно, ее файлы лежат здесь:
```
/usr/share/plymouth/themes/pix/
```
Заменяем файл изображения на свой


Выполните команду для обновления initramfs:
```
sudo update-initramfs -u
```
Этот процесс может занять от 30 секунд до минуты. Не прерывайте его.
Перезагрузите Raspberry Pi:
```
sudo reboot
```
